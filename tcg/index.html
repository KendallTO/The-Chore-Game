<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Chore Game - Home</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <h1 class="logo">The Chore Game</h1>
            <nav class="main-nav">
                <a href="tindex.html">Home</a>
                <a href="shop.html">Shop</a>
            </nav>
        </div>
    </header>
<!-- ...existing code... -->
    <main class="site-main container">
        <section class="grid-3">
            <div class="column">
                <h3 class="column-header" contenteditable="true" aria-label="Column 1 header">Column 1</h3>

                <!-- left column chores -->
                <div id="left-list">
                    <article class="card chore-placeholder">No chores assigned.</article>
                </div>
            </div>

            <div class="column" id="chores-column">
                <h3 class="column-header" aria-label="Unchoosen Chores">Unchoosen Chores</h3>

                <!-- random assign button -->
                <div>
                  <button id="random-assign-btn" type="button" class="btn">Randomly Assign Chores</button>
                </div>

                <!-- unchosen chores list (rendered by JS) -->
                <div id="chores-list">
                    <article class="card chore-placeholder">No chores yet — add one below.</article>
                </div>

                <!-- add-chore form -->
                <form id="add-chore-form" class="chore-form" aria-label="Add chore" novalidate>
                    <div class="form-row">
                        <label for="chore-name">Name<span class="req">*</span></label>
                        <input id="chore-name" name="name" type="text" required aria-required="true" />
                    </div>

                    <div class="form-row">
                        <label>Points</label>
                        <div style="padding:8px; color:#374151;">10 pts (fixed)</div>
                    </div>

                    <div class="form-row">
                        <button type="submit" class="btn">Add Chore</button>
                        <span id="chore-msg" class="form-msg" role="status" aria-live="polite"></span>
                    </div>
                </form>
            </div>

            <div class="column">
                <h3 class="column-header" contenteditable="true" aria-label="Column 3 header">Column 3</h3>

                <!-- right column chores -->
                <div id="right-list">
                    <article class="card chore-placeholder">No chores assigned.</article>
                </div>
            </div>
        </section>
    </main>
<!-- ...existing code... -->

    <footer class="site-footer">
        <div class="container">
            <p>© <span id="year"></span> The Chore Game</p>
        </div>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
    </script>

    <script>
    // chores: add, render, persist (localStorage)
    (function(){
      const STORAGE_KEY = 'tcg_chores_v1';
      const HEADERS_KEY = 'tcg_column_headers_v1';

      const leftListEl = document.getElementById('left-list');
      const unchosenListEl = document.getElementById('chores-list');
      const rightListEl = document.getElementById('right-list');

      const form = document.getElementById('add-chore-form');
      const nameInput = document.getElementById('chore-name');
      const msgEl = document.getElementById('chore-msg');

      // header elements (editable)
      const leftHeaderEl = document.querySelector('.grid-3 .column:nth-child(1) .column-header');
      const rightHeaderEl = document.querySelector('.grid-3 .column:nth-child(3) .column-header');

      function loadHeaders(){
        try{
          const raw = localStorage.getItem(HEADERS_KEY);
          const parsed = raw ? JSON.parse(raw) : {};
          return {
            left: parsed.left ?? (leftHeaderEl ? leftHeaderEl.textContent.trim() : 'Left'),
            right: parsed.right ?? (rightHeaderEl ? rightHeaderEl.textContent.trim() : 'Right')
          };
        }catch(e){
          return {
            left: leftHeaderEl ? leftHeaderEl.textContent.trim() : 'Left',
            right: rightHeaderEl ? rightHeaderEl.textContent.trim() : 'Right'
          };
        }
      }

      function saveHeaders(){
        if(!leftHeaderEl || !rightHeaderEl) return;
        const payload = {
          left: leftHeaderEl.textContent.trim(),
          right: rightHeaderEl.textContent.trim()
        };
        localStorage.setItem(HEADERS_KEY, JSON.stringify(payload));
      }

      // apply saved headers immediately
      const savedHeaders = loadHeaders();
      if(leftHeaderEl) leftHeaderEl.textContent = savedHeaders.left;
      if(rightHeaderEl) rightHeaderEl.textContent = savedHeaders.right;
      // save any normalization (optional)
      saveHeaders();

      // chores have shape: { id, name, points, loc } where loc is 'unchosen'|'left'|'right'
      function loadChores(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : [];
        }catch(e){
          return [];
        }
      }

      function saveChores(chores){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(chores));
      }

      function makeChoreCard(chore){
        const art = document.createElement('article');
        art.className = 'card chore';
        art.dataset.id = String(chore.id);
        art.dataset.loc = chore.loc || 'unchosen';

        const wrap = document.createElement('div');
        wrap.style.width = '100%';

        const title = document.createElement('h4');
        title.textContent = chore.name;
        title.style.margin = '0 0 6px 0';
        wrap.appendChild(title);

        const pts = document.createElement('p');
        pts.textContent = String(chore.points) + ' pts';
        pts.style.margin = '0';
        pts.style.fontWeight = '600';
        wrap.appendChild(pts);

        const actions = document.createElement('div');
        actions.style.marginTop = '8px';
        actions.style.display = 'flex';
        actions.style.gap = '8px';
        actions.style.flexWrap = 'wrap';

        // read current column header text so labels match whatever the headers show
        const leftHeaderText = document.querySelector('.grid-3 .column:nth-child(1) .column-header')?.textContent.trim() || 'Left';
        const rightHeaderText = document.querySelector('.grid-3 .column:nth-child(3) .column-header')?.textContent.trim() || 'Right';

        // action buttons depend on location
        if(!chore.loc || chore.loc === 'unchosen'){
          const assignLeft = document.createElement('button');
          assignLeft.type = 'button';
          assignLeft.className = 'btn';
          assignLeft.textContent = `Assign → ${leftHeaderText}`;
          assignLeft.dataset.action = 'assign-left';
          actions.appendChild(assignLeft);

          const assignRight = document.createElement('button');
          assignRight.type = 'button';
          assignRight.className = 'btn';
          assignRight.textContent = `Assign → ${rightHeaderText}`;
          assignRight.dataset.action = 'assign-right';
          actions.appendChild(assignRight);
        } else {
          const unassign = document.createElement('button');
          unassign.type = 'button';
          unassign.className = 'btn';
          unassign.textContent = 'Unassign';
          unassign.dataset.action = 'unassign';
          actions.appendChild(unassign);
        }

        const del = document.createElement('button');
        del.type = 'button';
        del.className = 'btn btn-delete';
        del.textContent = 'Delete';
        del.dataset.action = 'delete';
        actions.appendChild(del);

        wrap.appendChild(actions);
        art.appendChild(wrap);
        return art;
      }

      function render(){
        const chores = loadChores();

        leftListEl.innerHTML = '';
        unchosenListEl.innerHTML = '';
        rightListEl.innerHTML = '';

        const left = chores.filter(c => c.loc === 'left');
        const right = chores.filter(c => c.loc === 'right');
        const unchosen = chores.filter(c => !c.loc || c.loc === 'unchosen');

        if(!left.length){
          const ph = document.createElement('article');
          ph.className = 'card chore-placeholder';
          ph.textContent = 'No chores assigned.';
          leftListEl.appendChild(ph);
        } else {
          left.forEach(c => leftListEl.appendChild(makeChoreCard(c)));
        }

        if(!unchosen.length){
          const ph = document.createElement('article');
          ph.className = 'card chore-placeholder';
          ph.textContent = 'No chores yet — add one below.';
          unchosenListEl.appendChild(ph);
        } else {
          unchosen.forEach(c => unchosenListEl.appendChild(makeChoreCard(c)));
        }

        if(!right.length){
          const ph = document.createElement('article');
          ph.className = 'card chore-placeholder';
          ph.textContent = 'No chores assigned.';
          rightListEl.appendChild(ph);
        } else {
          right.forEach(c => rightListEl.appendChild(makeChoreCard(c)));
        }
      }

      form.addEventListener('submit', function(e){
        e.preventDefault();
        msgEl.textContent = '';

        const name = nameInput.value.trim();
        const points = 10; // fixed starting value

        if(!name){
          msgEl.textContent = 'Name required.';
          nameInput.focus();
          return;
        }

        const chores = loadChores();
        const newChore = { id: Date.now(), name, points: Math.floor(points), loc: 'unchosen' };
        chores.push(newChore);
        saveChores(chores);
        render();
        form.reset();
        msgEl.textContent = 'Chore added.';
        setTimeout(()=> msgEl.textContent = '', 1800);
      });

      // delegated action handler for all three lists
      document.querySelector('.grid-3').addEventListener('click', function(e){
        const btn = e.target.closest('button[data-action]');
        if(!btn) return;
        const action = btn.dataset.action;
        const card = btn.closest('.chore');
        if(!card) return;
        const id = Number(card.dataset.id);
        let chores = loadChores();
        const idx = chores.findIndex(c => c.id === id);
        if(idx === -1) return;

        if(action === 'assign-left'){
          chores[idx].loc = 'left';
          saveChores(chores);
          render();
          return;
        }
        if(action === 'assign-right'){
          chores[idx].loc = 'right';
          saveChores(chores);
          render();
          return;
        }
        if(action === 'unassign'){
          chores[idx].loc = 'unchosen';
          saveChores(chores);
          render();
          return;
        }
        if(action === 'delete'){
          if(!confirm('Delete this chore?')) return;
          chores.splice(idx, 1);
          saveChores(chores);
          render();
          return;
        }
      });

      // random assign button: distribute unchosen chores randomly to left or right
      const randomAssignBtn = document.getElementById('random-assign-btn');
      if(randomAssignBtn){
        // balanced assignment: aim for equal counts (difference at most 1)
        randomAssignBtn.addEventListener('click', function(){
          const chores = loadChores();
          const unchosen = chores.filter(c => !c.loc || c.loc === 'unchosen');
          if(!unchosen.length){
            msgEl.textContent = 'No unassigned chores to assign.';
            setTimeout(()=> msgEl.textContent = '', 1800);
            return;
          }

          // count current items
          let leftCount = chores.filter(c => c.loc === 'left').length;
          let rightCount = chores.filter(c => c.loc === 'right').length;

          // shuffle unchosen so distribution is not deterministic
          for(let i = unchosen.length - 1; i > 0; i--){
            const j = Math.floor(Math.random() * (i + 1));
            [unchosen[i], unchosen[j]] = [unchosen[j], unchosen[i]];
          }

          // assign each unchosen chore to the column with fewer chores,
          // if equal pick randomly — this ensures near-equal distribution
          const idsToAssign = new Set(unchosen.map(c => c.id));
          chores.forEach(c => {
            if(!idsToAssign.has(c.id)) return;
            if(leftCount < rightCount){
              c.loc = 'left';
              leftCount++;
            } else if(rightCount < leftCount){
              c.loc = 'right';
              rightCount++;
            } else {
              // counts equal — pick randomly
              if(Math.random() < 0.5){ c.loc = 'left'; leftCount++; }
              else { c.loc = 'right'; rightCount++; }
            }
          });

          saveChores(chores);
          render();
          msgEl.textContent = `Assigned ${unchosen.length} chore(s) (balanced).`;
          setTimeout(()=> msgEl.textContent = '', 1800);
        });
      }

      // re-render when either column header text changes so button labels stay in sync
      [leftHeaderEl, rightHeaderEl].forEach(h => {
        if(!h) return;
        // save header text and re-render as the user types / on blur
        h.addEventListener('input', () => {
          saveHeaders();
          render();
        });
        h.addEventListener('blur', () => {
          saveHeaders();
          render();
        });
      });

      // initial render
      render();
    })();
    </script>
</body>
</html>
