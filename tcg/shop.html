<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>The Chore Game - Shop</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <h1 class="logo">The Chore Game Shop</h1>
            <nav class="main-nav">
                <a href="index.html">Home</a>
                <a href="shop.html">Shop</a>
            </nav>
        </div>
    </header>

    <main class="site-main container">
        <h2>Shop</h2>

        <!-- Add item form -->
        <form id="add-item-form" class="shop-form" aria-label="Add shop item" novalidate>
            <div class="form-row">
                <label for="item-name">Name<span class="req">*</span></label>
                <input id="item-name" name="name" type="text" required aria-required="true" />
            </div>

            <div class="form-row">
                <label for="item-desc">Description (optional)</label>
                <textarea id="item-desc" name="description" rows="2"></textarea>
            </div>

            <div class="form-row">
                <label for="item-price">Price (points)<span class="req">*</span></label>
                <input id="item-price" name="price" type="number" min="0" step="1" required aria-required="true" />
            </div>

            <!-- NEW: one-time purchase checkbox -->
            <div class="form-row">
                <label for="item-one-time">One-time purchase</label>
                <input id="item-one-time" name="oneTime" type="checkbox" aria-label="Mark as one-time purchase" />
            </div>

            <div class="form-row">
                <button type="submit">Add Item</button>
                <span id="form-msg" class="form-msg" role="status" aria-live="polite"></span>
            </div>
        </form>

        <section id="products" class="grid-3" aria-live="polite">
            <!-- items rendered here -->
        </section>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>© <span id="year2"></span> The Chore Game</p>
        </div>
    </footer>

    <script>
        // minimal shop logic: store items in localStorage, render them, allow adding + purchase/delete
        (function(){
            const STORAGE_KEY = 'tcg_shop_items_v1';
            const defaultItems = [
                { id: Date.now()+1, name: 'Product 1', description: 'Sample item', price: 50, oneTime: false },
                { id: Date.now()+2, name: 'Product 2', description: '', price: 30, oneTime: true },
                { id: Date.now()+3, name: 'Product 3', description: '', price: 20, oneTime: false }
            ];

            const form = document.getElementById('add-item-form');
            const nameInput = document.getElementById('item-name');
            const descInput = document.getElementById('item-desc');
            const priceInput = document.getElementById('item-price');
            const oneTimeInput = document.getElementById('item-one-time');
            const productsEl = document.getElementById('products');
            const msgEl = document.getElementById('form-msg');

            function loadItems(){
                try{
                    const raw = localStorage.getItem(STORAGE_KEY);
                    return raw ? JSON.parse(raw) : defaultItems.slice();
                }catch(e){
                    return defaultItems.slice();
                }
            }

            function saveItems(items){
                localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
            }

            function createCard(item){
                const art = document.createElement('article');
                art.className = 'card product';
                art.dataset.id = String(item.id);

                const titleWrap = document.createElement('div');
                titleWrap.className = 'product-title-wrap';

                const title = document.createElement('h3');
                title.className = 'product-title';
                title.textContent = item.name;
                titleWrap.appendChild(title);

                if(item.oneTime){
                    const badge = document.createElement('span');
                    badge.className = 'badge one-time';
                    badge.textContent = 'One‑time';
                    titleWrap.appendChild(badge);
                }

                art.appendChild(titleWrap);

                if(item.description){
                    const p = document.createElement('p');
                    p.className = 'product-desc';
                    p.textContent = item.description;
                    art.appendChild(p);
                }

                const price = document.createElement('p');
                price.className = 'product-price';
                price.textContent = item.price + ' pts';
                art.appendChild(price);

                // actions: purchase + delete
                const actions = document.createElement('div');
                actions.className = 'product-actions';

                const buyBtn = document.createElement('button');
                buyBtn.type = 'button';
                buyBtn.className = 'btn btn-purchase';
                buyBtn.dataset.action = 'purchase';
                buyBtn.textContent = 'Purchase';
                actions.appendChild(buyBtn);

                const delBtn = document.createElement('button');
                delBtn.type = 'button';
                delBtn.className = 'btn btn-delete';
                delBtn.dataset.action = 'delete';
                delBtn.textContent = 'Delete';
                actions.appendChild(delBtn);

                art.appendChild(actions);

                return art;
            }

            function render(){
                const items = loadItems();
                productsEl.innerHTML = '';
                items.forEach(it => productsEl.appendChild(createCard(it)));
            }

            form.addEventListener('submit', function(e){
                e.preventDefault();
                msgEl.textContent = '';

                const name = nameInput.value.trim();
                const desc = descInput.value.trim();
                const price = Number(priceInput.value);
                const oneTime = !!oneTimeInput.checked;

                if(!name){
                    msgEl.textContent = 'Name is required.';
                    nameInput.focus();
                    return;
                }
                if(Number.isNaN(price) || price < 0){
                    msgEl.textContent = 'Enter a valid price (0 or more).';
                    priceInput.focus();
                    return;
                }

                const items = loadItems();
                const newItem = { id: Date.now(), name, description: desc, price: Math.floor(price), oneTime };
                items.push(newItem);
                saveItems(items);
                render();

                form.reset();
                msgEl.textContent = 'Item added.';
                setTimeout(()=> msgEl.textContent = '', 2000);
            });

            // delegated click handler for purchase / delete
            productsEl.addEventListener('click', function(e){
                const btn = e.target.closest('button[data-action]');
                if(!btn) return;
                const action = btn.dataset.action;
                const card = btn.closest('.product');
                if(!card) return;
                const id = Number(card.dataset.id);
                if(action === 'purchase'){
                    purchaseItem(id);
                } else if(action === 'delete'){
                    deleteItem(id);
                }
            });

            function purchaseItem(id){
                const items = loadItems();
                const idx = items.findIndex(i => i.id === id);
                if(idx === -1) return;
                const item = items[idx];

                if(!confirm(`Purchase "${item.name}" for ${item.price} pts?`)) return;

                if(item.oneTime){
                    // remove one-time items on purchase
                    items.splice(idx, 1);
                    saveItems(items);
                    render();
                    msgEl.textContent = 'Purchased — one‑time item removed.';
                    setTimeout(()=> msgEl.textContent = '', 2000);
                }else{
                    // non one-time: keep it but show confirmation
                    msgEl.textContent = 'Purchased.';
                    setTimeout(()=> msgEl.textContent = '', 2000);
                }
            }

            function deleteItem(id){
                const items = loadItems();
                const idx = items.findIndex(i => i.id === id);
                if(idx === -1) return;
                const item = items[idx];
                if(!confirm(`Delete "${item.name}" from the shop?`)) return;
                items.splice(idx, 1);
                saveItems(items);
                render();
                msgEl.textContent = 'Item deleted.';
                setTimeout(()=> msgEl.textContent = '', 2000);
            }

            // set year and initial render
            document.getElementById('year2').textContent = new Date().getFullYear();
            render();
        })();
    </script>
</body>
</html>
